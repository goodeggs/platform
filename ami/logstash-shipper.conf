#!upstart

start on started docker
stop on (runlevel [^2345] and net-device-down IFACE=eth0)

respawn
respawn limit unlimited

pre-start script
  mkdir -p /var/log/upstart
  docker pull goodeggs/ranch-logstash-shipper || true # don't stop if the pull fails
end script

script
  . /etc/goodeggs-environment
  exec docker run -a STDOUT -a STDERR --sig-proxy \
    -e "KINESIS_STREAM_NAME=$LOGSTASH_KINESIS_STREAM_NAME" \
    -e "AWS_ACCESS_KEY_ID=$LOGSTASH_AWS_ACCESS_KEY_ID" \
    -e "AWS_SECRET_ACCESS_KEY=$LOGSTASH_AWS_SECRET_ACCESS_KEY" \
    -e "AWS_DEFAULT_REGION" \
    goodeggs/ranch-logstash-shipper >> /var/log/logstash-shipper.log 2>&1
end script

